<!DOCTYPE html>
<html>

<head>
    <title>Select Information</title>
    <meta name="viewport" width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0>
    <!-- ////////////////////////////////////////////////////////////////////////////////////////////// -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="" />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
    <link rel="stylesheet" type="text/css" href="css/custom.css">
</head>

<body>
    <div class="layout-first" style="padding: 1%">
        <div class="container">
            <h2>Sistem Informasi Geografis</h2>
        </div>
        <div class="input-group-sm" style="width:100%;height:auto;background-color:white;z-index:50;  display: flex;flex-wrap: wrap;align-items: center;justify-content: center; ">
            <select style="width: 20%;margin: 15px" class="form-control" placeholder="input 1" type="text" name="disaster" id="disaster">
            </select>
            <select style="width: 20%;margin: 15px" class="form-control" placeholder="input 2" type="text" name="province" id="province">
            </select>
            <button class="btn btn-secondary" type="button" role="button" id="button-find">Find </button>
        </div>
        <div class="row" style="margin: 10px">
            <div class="col-3">
                <div class="card">
                    <div class="card-header">
                        Information
                    </div>
                    <div class="card-body collapse multi-collapse1" id="multiCollapseExample1">
                        <div class="row">
                            <div class="accordion" id="accordionExample" style="width: 100%">
                                <div class="card">
                                    <div class="card-header" style="padding: inherit; " id="headingOne">
                                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                            Cluster 1 <img style="max-height: 10px" src="img/arrow/down.png">
                                        </button>
                                    </div>
                                    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                                        <div class="card-body" style="padding: 2%;">
                                            <table id="table-cluster_1">
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion" id="accordionExample" style="width: 100%">
                                <div class="card">
                                    <div class="card-header" style="padding: inherit; " id="headingTwo">
                                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
                                            Cluster 2 <img style="max-height: 10px" src="img/arrow/down.png">
                                        </button>
                                    </div>
                                    <div id="collapseTwo" class="collapse show" aria-labelledby="headingTwo" data-parent="#accordionExample">
                                        <div class="card-body" style="padding: 2%;">
                                            <table id="table-cluster_2">
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion" id="accordionExample" style="width: 100%">
                                <div class="card">
                                    <div class="card-header" style="padding: inherit; " id="headingThree">
                                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree">
                                            Cluster 3 <img style="max-height: 10px" src="img/arrow/down.png">
                                        </button>
                                    </div>
                                    <div id="collapseThree" class="collapse show" aria-labelledby="headingThree" data-parent="#accordionExample">
                                        <div class="card-body" style="padding: 2%;">
                                            <table id="table-cluster_3">
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br />
                            <br />
                            <p class="card-text" id="information-left-card"> </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <div class="card">
                    <div class="card-header" id="main-card">
                        Disaster
                    </div>
                    <div class="card-body">
                        <h5 class="card-title" id="title-main-card"></h5>
                        <img id="img-main-card" src="" style="width:100%;">
                        <!--  <div class="row" >
                        <div class="col-12" id="map" style=""> 
                        
                    </div> -->
                        <!-- <p class="card-text">Pusing kakkk</p> -->
                        <div class="input-group-sm">
                            <a data-toggle="collapse" href="#multiCollapseExample1" role="button" aria-expanded="false" aria-controls="multiCollapseExample1" class="btn btn-primary" style="margin: 10px">Information</a>
                            <a data-toggle="collapse" href="#multiCollapseExample2" role="button" aria-expanded="false" aria-controls="multiCollapseExample2" class="btn btn-primary" style="margin: 10px">Video</a>
                            <a data-toggle="collapse" href="#multiCollapseExample3" role="button" aria-expanded="false" aria-controls="multiCollapseExample3" class="btn btn-primary" style="margin: 10px">Audio</a>
                        </div>
                        <div class="collapse multi-collapse" id="multiCollapseExample1">
                            <div class="card card-body" id="information-main-card">
                                <table>
                                    <tr id="cluster_heading">
                                    </tr>
                                    <tr id="cluster_information">
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-3">
                <div class="card">
                    <div class="card-header">
                        Video / Audio
                    </div>
                    <div class="card-body collapse multi-collapse2" id="multiCollapseExample2">
                        <div class="row">
                            <iframe id="video-right-card" width="320" height="240" src="" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    </div>
                    <hr>
                    <div class="card-body collapse multi-collapse3" id="multiCollapseExample3">
                        <div class="row">
                            <audio controls>
                                <source id="audio-right-card" src="" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<!-- Javascript -->
<script src="../admin/vendor/jquery/jquery.min.js"></script>
<!-- <script src="../admin/vendor/bootstrap/js/bootstrap.min.js"></script> -->
<!-- <script src="../admin/vendor/jquery.cookie/jquery.cookie.js"> </script> -->
<script type="text/javascript">
$(document).ready(function() {
    // retrieve display options
    retrieve_data_disaster();
    retrieve_data_province();

    function retrieve_data_disaster() {
        $.ajax({
            type: 'GET',
            url: 'http://localhost/GIS/admin/model/get_data_disaster.php',
            async: true,
            dataType: 'json',
            success: function(data) {
                let html_option = '';
                let i;
                for (i = 0; i < data.length; i++) {
                    html_option += '<option value="' + data[i].id_disaster + '">' + data[i].disaster + '</option>';
                }
                $('#disaster').html(html_option);
            }

        });
    }

    function retrieve_data_province() {

        $.ajax({
            type: 'GET',
            url: 'http://localhost/GIS/admin/model/get_data_province.php',
            async: true,
            dataType: 'json',
            success: function(data) {
                let html_option = '';
                let i;

                for (i = 0; i < data.length; i++) {
                    html_option += '<option value="' + data[i].id_province + '">' + data[i].province + '</option>';
                }
                $('#province').html(html_option);
            }

        });
    }

    $('#button-find').on('click', function() {
        let id_province = $('#province').val();
        let id_disaster = $('#disaster').val();
        console.log(id_disaster);
        $.ajax({
            type: 'post',
            url: 'http://localhost/GIS/admin/model/retrieve_data_view_user.php',
            async: true,
            dataType: 'json',
            data: { id_province: id_province, id_disaster: id_disaster },
            success: function(data) {
                let html_cluster = '';
                let html_heading_cluster = '';
                let img_color = ["red", "blue", "purple"];
                let i;

                $("#video-right-card").attr("src", data[0].link_video);
                $("#audio-right-card").attr("src", data[0].link_audio);
                $("#img-main-card").attr("src", data[0].link_img);
                $("#information-left-card").html("<p>" + data[1].detail_information + "</p>");

                for (i = 2; i < data.length; i++) {
                    html_cluster += '<td>' + data[i].cluster_information + '</td>';
                    html_heading_cluster += '<th>' + data[i].cluster + '<img src="img/pin/' + img_color[i - 2] + '.png" style="max-height: 25px"></th>';
                }
                $('#cluster_information').html(html_cluster);
                $('#cluster_heading').html(html_heading_cluster);
            }

        });

        $.ajax({
            type: 'post',
            url: 'http://localhost/GIS/admin/model/retrieve_data_cluster_user.php',
            async: true,
            dataType: 'json',
            data: { id_province: id_province, id_disaster: id_disaster },
            success: function(data) {
                let html_cluster1 = '';
                let html_cluster2 = '';
                let html_cluster3 = '';
                let i;

                for (i = 0; i < data.length; i++) {
                    if (data[i].cluster == "Cluster 1") html_cluster1 += '<tr><td>' + data[i].region + '</td></tr>';
                    else if (data[i].cluster == "Cluster 2") html_cluster2 += '<tr><td>' + data[i].region + '</td></tr>';
                    else if (data[i].cluster == "Cluster 3") html_cluster3 += '<tr><td>' + data[i].region + '</td></tr>';
                }

                $("#table-cluster_1").html(html_cluster1);
                $("#table-cluster_2").html(html_cluster2);
                $("#table-cluster_3").html(html_cluster3);

            }

        });
    })
})
</script>